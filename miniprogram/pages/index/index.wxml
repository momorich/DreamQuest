<!--index.wxml-->
<view class="container">
  <!-- èƒŒæ™¯å›¾ç‰‡ -->
  <image class="bg-image" src="/assets/images/main_bg.png" mode="aspectFill"></image>
  
  <!-- é¡¶éƒ¨ -->
  <view class="header">
    <view class="logo-wrapper">
      <image class="logo" src="/assets/tabbar/record_selected.png" mode="aspectFit"></image>
      <text class="app-name">æ¢¦å¯»</text>
    </view>
    <view class="date-wrapper">
      <text class="date">{{dateInfo.date}}</text>
      <text class="weekday">{{dateInfo.weekday}}</text>
      <text class="lunar">{{dateInfo.lunar}}</text>
    </view>
  </view>

  <!-- æ¢¦å¢ƒçŸ¥è¯† -->
  <view class="dream-theory">
    <view class="theory-title">
      <text class="theory-icon">âœ¨</text>
      <text>{{dreamTheory.title}}</text>
    </view>
    <text class="theory-content">{{dreamTheory.content}}</text>
  </view>

  <!-- ä»Šæ—¥è¿åŠ¿ -->
  <view class="fortune-card" bindtap="{{hasSelectedZodiac ? 'toggleFortune' : ''}}">
    <view class="card-title">
      <text>ğŸ“… ä»Šæ—¥è¿åŠ¿</text>
    </view>
    
    <!-- æœªé€‰æ‹©æ˜Ÿåº§æ—¶æ˜¾ç¤º -->
    <view class="zodiac-selector" wx:if="{{!hasSelectedZodiac}}">
      <picker bindchange="handleZodiacChange" value="{{zodiacIndex}}" range="{{zodiacs}}">
        <view class="picker-content">
          <text>{{zodiacIndex > -1 ? zodiacs[zodiacIndex] : 'é€‰æ‹©æ˜Ÿåº§'}}</text>
          <text class="arrow">â–¼</text>
        </view>
      </picker>
    </view>

    <!-- å·²é€‰æ‹©æ˜Ÿåº§æ—¶æ˜¾ç¤ºè¿åŠ¿å†…å®¹ -->
    <view class="fortune-content {{isFortuneExpanded ? 'expanded' : ''}}" wx:else>
      <view class="fortune-item">
        <text class="item-title">âœ¨ æ•´ä½“è¿åŠ¿ï¼š</text>
        <text class="item-content">{{fortune.overall}}</text>
      </view>
      <view class="fortune-item">
        <text class="item-title">ğŸ’¼ äº‹ä¸šè¿åŠ¿ï¼š</text>
        <text class="item-content">{{fortune.career}}</text>
      </view>
      <view class="fortune-item">
        <text class="item-title">ğŸ’• çˆ±æƒ…è¿åŠ¿ï¼š</text>
        <text class="item-content">{{fortune.love}}</text>
      </view>
      <view class="fortune-item">
        <text class="item-title">ğŸ’° è´¢å¯Œè¿åŠ¿ï¼š</text>
        <text class="item-content">{{fortune.money}}</text>
      </view>
      <view class="fortune-item">
        <text class="item-title">ğŸƒ å¥åº·è¿åŠ¿ï¼š</text>
        <text class="item-content">{{fortune.health}}</text>
      </view>
      <view class="fortune-numbers">
        <text>ğŸ”¢ å¹¸è¿æ•°å­—ï¼š{{fortune.luckyNumber}}</text>
        <text>ğŸ¨ å¹¸è¿è‰²ï¼š{{fortune.luckyColor}}</text>
        <text>ğŸ§­ å¹¸è¿æ˜Ÿåº§ï¼š{{fortune.luckyDirection}}</text>
      </view>
    </view>
  </view>

  <!-- æ¢¦å¢ƒå‘¨æŠ¥ -->
  <view class="weekly-report card" bindtap="toggleReport">
    <view class="card-title">
      <text>ğŸ—’ï¸ æ¢¦å¢ƒå‘¨æŠ¥</text>
    </view>
    
    <!-- é…å›¾åŒºåŸŸ -->
    <image class="report-image" src="{{weeklyReport.image || '/assets/default_dream.png'}}" mode="aspectFill"></image>
    
    <!-- è¯¦ç»†å†…å®¹åŒºåŸŸ -->
    <view class="report-content {{isReportExpanded ? 'expanded' : ''}}">
      <!-- å…³é”®è¯ -->
      <view class="report-section">
        <text class="section-title">ğŸ“Š å…³é”®è¯ï¼š</text>
        <text class="section-content">{{weeklyReport.keywords}}</text>
      </view>
      
      <!-- æ¢¦å¢ƒè§£æ -->
      <view class="report-section">
        <text class="section-title">ğŸ’­ æ¢¦å¢ƒè§£æï¼š</text>
        <text class="section-content">{{weeklyReport.analysis}}</text>
      </view>
      
      <!-- æƒ…ç»ªè¶‹åŠ¿ -->
      <view class="report-section">
        <text class="section-title">ğŸ“ˆ æƒ…ç»ªè¶‹åŠ¿ï¼š</text>
        <text class="section-content">{{weeklyReport.emotionTrend}}</text>
      </view>
      
      <!-- AIå»ºè®® -->
      <view class="report-section">
        <text class="section-title">ğŸ¤– AIå»ºè®®ï¼š</text>
        <text class="section-content">{{weeklyReport.aiSuggestion}}</text>
      </view>
    </view>
  </view>

  <!-- åº•éƒ¨è¾“å…¥åŒºåŸŸ -->
  <view class="input-section">
    <view class="chat-bubble">æ˜¨æ™šæ¢¦åˆ°ä»€ä¹ˆäº†å˜›?è®°å½•ä¸€ä¸‹å§ ğŸ¤—</view>
    <view class="input-area">
      <view class="dream-input" bindtap="showDreamInput">
        <input placeholder="write your dream" 
               placeholder-style="color: rgba(60, 60, 67, 0.6)" 
               disabled />
        <image class="voice-icon" src="/assets/icons/voice.png" mode="aspectFit" />
      </view>
    </view>
  </view>

  <!-- åœ¨åº•éƒ¨æ·»åŠ æ¢¦å¢ƒè¾“å…¥ç»„ä»¶ -->
  <dream-input 
    show="{{showDreamInput}}" 
    bind:save="onDreamSave"
    bind:close="hideDreamInput"
  />

  <!-- æ·»åŠ æ¢¦å¢ƒåˆ†ææµ®å±‚ -->
  <dream-analysis
    visible="{{showDreamAnalysis}}"
    dreamData="{{currentDream}}"
    bind:close="onDreamAnalysisClose"
  />
</view>
